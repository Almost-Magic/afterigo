import{r as O,g as G,R as J}from"./vendor-C8arOna2.js";import{X as W}from"./storage-2jmnBxhj.js";const L={},T=e=>{let t;const n=new Set,r=(m,p)=>{const g=typeof m=="function"?m(t):m;if(!Object.is(g,t)){const d=t;t=p??(typeof g!="object"||g===null)?g:Object.assign({},t,g),n.forEach(v=>v(t,d))}},s=()=>t,y={setState:r,getState:s,getInitialState:()=>l,subscribe:m=>(n.add(m),()=>n.delete(m)),destroy:()=>{(L?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},l=t=e(r,s,y);return y},M=e=>e?T(e):T;var j={exports:{}},x={},$={exports:{}},H={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b=O;function V(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var X=typeof Object.is=="function"?Object.is:V,q=b.useState,Q=b.useEffect,Y=b.useLayoutEffect,Z=b.useDebugValue;function ee(e,t){var n=t(),r=q({inst:{value:n,getSnapshot:t}}),s=r[0].inst,o=r[1];return Y(function(){s.value=n,s.getSnapshot=t,C(s)&&o({inst:s})},[e,n,t]),Q(function(){return C(s)&&o({inst:s}),e(function(){C(s)&&o({inst:s})})},[e]),Z(n),n}function C(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!X(e,n)}catch{return!0}}function te(e,t){return t()}var re=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?te:ee;H.useSyncExternalStore=b.useSyncExternalStore!==void 0?b.useSyncExternalStore:re;$.exports=H;var ne=$.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A=O,oe=ne;function se(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ae=typeof Object.is=="function"?Object.is:se,ie=oe.useSyncExternalStore,ce=A.useRef,ue=A.useEffect,le=A.useMemo,de=A.useDebugValue;x.useSyncExternalStoreWithSelector=function(e,t,n,r,s){var o=ce(null);if(o.current===null){var u={hasValue:!1,value:null};o.current=u}else u=o.current;o=le(function(){function y(d){if(!l){if(l=!0,m=d,d=r(d),s!==void 0&&u.hasValue){var v=u.value;if(s(v,d))return p=v}return p=d}if(v=p,ae(m,d))return v;var c=r(d);return s!==void 0&&s(v,c)?(m=d,v):(m=d,p=c)}var l=!1,m,p,g=n===void 0?null:n;return[function(){return y(t())},g===null?void 0:function(){return y(g())}]},[t,n,r,s]);var f=ie(e,o[0],o[1]);return ue(function(){u.hasValue=!0,u.value=f},[f]),de(f),f};j.exports=x;var fe=j.exports;const ye=G(fe),P={},{useDebugValue:me}=J,{useSyncExternalStoreWithSelector:ve}=ye;let k=!1;const he=e=>e;function ge(e,t=he,n){(P?"production":void 0)!=="production"&&n&&!k&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),k=!0);const r=ve(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return me(r),r}const D=e=>{(P?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?M(e):e,n=(r,s)=>ge(t,r,s);return Object.assign(n,t),n},pe=e=>e?D(e):D,Se={};function we(e,t){let n;try{n=e()}catch{return}return{getItem:s=>{var o;const u=y=>y===null?null:JSON.parse(y,void 0),f=(o=n.getItem(s))!=null?o:null;return f instanceof Promise?f.then(u):u(f)},setItem:(s,o)=>n.setItem(s,JSON.stringify(o,void 0)),removeItem:s=>n.removeItem(s)}}const _=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(r){return _(r)(n)},catch(r){return this}}}catch(n){return{then(r){return this},catch(r){return _(r)(n)}}}},be=(e,t)=>(n,r,s)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:i=>i,version:0,merge:(i,h)=>({...h,...i}),...t},u=!1;const f=new Set,y=new Set;let l;try{l=o.getStorage()}catch{}if(!l)return e((...i)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),n(...i)},r,s);const m=_(o.serialize),p=()=>{const i=o.partialize({...r()});let h;const a=m({state:i,version:o.version}).then(S=>l.setItem(o.name,S)).catch(S=>{h=S});if(h)throw h;return a},g=s.setState;s.setState=(i,h)=>{g(i,h),p()};const d=e((...i)=>{n(...i),p()},r,s);let v;const c=()=>{var i;if(!l)return;u=!1,f.forEach(a=>a(r()));const h=((i=o.onRehydrateStorage)==null?void 0:i.call(o,r()))||void 0;return _(l.getItem.bind(l))(o.name).then(a=>{if(a)return o.deserialize(a)}).then(a=>{if(a)if(typeof a.version=="number"&&a.version!==o.version){if(o.migrate)return o.migrate(a.state,a.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return a.state}).then(a=>{var S;return v=o.merge(a,(S=r())!=null?S:d),n(v,!0),p()}).then(()=>{h==null||h(v,void 0),u=!0,y.forEach(a=>a(v))}).catch(a=>{h==null||h(void 0,a)})};return s.persist={setOptions:i=>{o={...o,...i},i.getStorage&&(l=i.getStorage())},clearStorage:()=>{l==null||l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>c(),hasHydrated:()=>u,onHydrate:i=>(f.add(i),()=>{f.delete(i)}),onFinishHydration:i=>(y.add(i),()=>{y.delete(i)})},c(),v||d},Ee=(e,t)=>(n,r,s)=>{let o={storage:we(()=>localStorage),partialize:c=>c,version:0,merge:(c,i)=>({...i,...c}),...t},u=!1;const f=new Set,y=new Set;let l=o.storage;if(!l)return e((...c)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),n(...c)},r,s);const m=()=>{const c=o.partialize({...r()});return l.setItem(o.name,{state:c,version:o.version})},p=s.setState;s.setState=(c,i)=>{p(c,i),m()};const g=e((...c)=>{n(...c),m()},r,s);s.getInitialState=()=>g;let d;const v=()=>{var c,i;if(!l)return;u=!1,f.forEach(a=>{var S;return a((S=r())!=null?S:g)});const h=((i=o.onRehydrateStorage)==null?void 0:i.call(o,(c=r())!=null?c:g))||void 0;return _(l.getItem.bind(l))(o.name).then(a=>{if(a)if(typeof a.version=="number"&&a.version!==o.version){if(o.migrate)return[!0,o.migrate(a.state,a.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,a.state];return[!1,void 0]}).then(a=>{var S;const[U,B]=a;if(d=o.merge(B,(S=r())!=null?S:g),n(d,!0),U)return m()}).then(()=>{h==null||h(d,void 0),d=r(),u=!0,y.forEach(a=>a(d))}).catch(a=>{h==null||h(void 0,a)})};return s.persist={setOptions:c=>{o={...o,...c},c.storage&&(l=c.storage)},clearStorage:()=>{l==null||l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>v(),hasHydrated:()=>u,onHydrate:c=>(f.add(c),()=>{f.delete(c)}),onFinishHydration:c=>(y.add(c),()=>{y.delete(c)})},o.skipHydration||v(),d||g},_e=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((Se?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),be(e,t)):Ee(e,t),Ie=_e,z="AFTER_I_GO_PASSWORD_CHECK";function R(e){const t=new Uint8Array(e);let n="";for(let r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function F(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n.buffer}function Ae(){return crypto.getRandomValues(new Uint8Array(16))}function Ce(){return crypto.getRandomValues(new Uint8Array(12))}async function I(e,t){const r=new TextEncoder().encode(e),s=await crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function K(e,t,n){const r=Ce(),o=new TextEncoder().encode(e),u=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,o);return{iv:R(r),ciphertext:R(u),salt:R(n)}}async function N(e,t){const n=new TextDecoder,r=F(e.iv),s=F(e.ciphertext),o=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,s);return n.decode(o)}async function Re(e,t){const n=await I(e,t);return K(z,n,t)}async function Te(e,t,n){try{const r=await I(e,t);return await N(n,r)===z}catch{return!1}}async function Fe(e,t,n){const r=JSON.stringify(e);return K(r,t,n)}async function Oe(e,t){const n=await N(e,t);return JSON.parse(n)}const w=new W("AfterIGoDB");w.version(1).stores({accounts:"++id, category, serviceName, priority, updatedAt",messages:"++id, recipientId, type, updatedAt",shares:"++id, status, updatedAt",unlockRequests:"++id, status, requestedAt",settings:"key"});const E={async get(e){const t=await w.settings.get(e);return t==null?void 0:t.value},async set(e,t){await w.settings.put({key:e,value:t})},async delete(e){return w.settings.delete(e)},async getAll(){return(await w.settings.toArray()).reduce((t,{key:n,value:r})=>(t[n]=r,t),{})},async clear(){return w.settings.clear()}},je=pe()(Ie((e,t)=>({isAuthenticated:!1,masterKey:null,salt:null,passwordCheck:null,isFirstTime:!0,loading:!1,error:null,createAccount:async n=>{e({loading:!0,error:null});try{const r=Ae(),s=await Re(n,r);await E.set("passwordCheck",s),await E.set("salt",Array.from(r));const o=await I(n,r);e({isAuthenticated:!0,masterKey:o,salt:r,passwordCheck:s,isFirstTime:!1,loading:!1})}catch(r){throw e({error:String(r),loading:!1}),r}},login:async n=>{e({loading:!0,error:null});try{const r=await E.get("passwordCheck"),s=await E.get("salt");if(!r||!s)return e({error:"No account found",loading:!1}),!1;const o=new Uint8Array(s),u=JSON.parse(r);if(!await Te(n,o,u))return e({error:"Incorrect password",loading:!1}),!1;const y=await I(n,o);return e({isAuthenticated:!0,masterKey:y,salt:o,passwordCheck:u,isFirstTime:!1,loading:!1}),!0}catch(r){return e({error:String(r),loading:!1}),!1}},logout:()=>{e({isAuthenticated:!1,masterKey:null,error:null})},clearError:()=>{e({error:null})},checkIsFirstTime:async()=>{const r=!await E.get("passwordCheck");return e({isFirstTime:r}),r}}),{name:"auth-store",partialize:e=>({isFirstTime:e.isFirstTime})}));export{pe as c,Oe as d,Fe as e,E as s,je as u};
