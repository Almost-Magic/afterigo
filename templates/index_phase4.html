<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ELAINE â€” Almost Magic Tech Lab</title>
<meta name="theme-color" content="#0A0E14">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%230A0E14'/%3E%3Ctext x='16' y='22' text-anchor='middle' font-family='Georgia,serif' font-size='18' font-weight='700' fill='%23C9944A'%3EE%3C/text%3E%3C/svg%3E">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALMOST MAGIC TECH LAB â€” DESIGN SYSTEM
   Dark-mode native. Gold is precious.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

:root {
  /* Core Palette */
  --midnight: #0A0E14;
  --deep-navy: #151B26;
  --navy: #1E2536;
  --cream: #E8E4DC;
  --warm-white: #F5F2ED;
  --gold: #C9944A;
  --amber: #B37D3A;

  /* Semantic */
  --success: #4A9B7F;
  --warning: #D4A04A;
  --error: #C75D5D;
  --info: #5A8FC9;

  /* Neutrals */
  --neutral-400: #9A968C;
  --neutral-500: #6E6A62;
  --neutral-600: #4A4740;

  /* Spacing */
  --sp-xs: 4px;
  --sp-sm: 8px;
  --sp-md: 16px;
  --sp-lg: 24px;
  --sp-xl: 32px;
  --sp-2xl: 48px;

  /* Radius */
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;

  /* Transitions */
  --ease: cubic-bezier(0.4, 0, 0.2, 1);
}

/* â”€â”€â”€ Light Mode â”€â”€â”€ */
html[data-theme="light"] {
  --midnight: #F8F7F5;
  --deep-navy: #EFEEE9;
  --navy: #E0DED6;
  --cream: #2D2B27;
  --warm-white: #1A1917;
  --gold: #C9944A;
  --amber: #B37D3A;
  --neutral-400: #6E6A62;
  --neutral-500: #9A968C;
  --neutral-600: #C4C1B8;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'DM Sans', system-ui, sans-serif;
  background: var(--midnight);
  color: var(--cream);
  line-height: 1.6;
  overflow: hidden;
  height: 100vh;
}

h1, h2, h3, h4 {
  font-family: 'Cormorant Garamond', Georgia, serif;
  color: var(--warm-white);
  font-weight: 600;
}

/* â”€â”€â”€ Layout â”€â”€â”€ */
.app {
  display: flex;
  height: 100vh;
}

/* â”€â”€â”€ Sidebar â”€â”€â”€ */
.sidebar {
  width: 260px;
  background: var(--deep-navy);
  border-right: 1px solid rgba(201, 148, 74, 0.1);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}

.sidebar-brand {
  padding: var(--sp-lg);
  border-bottom: 1px solid rgba(201, 148, 74, 0.08);
}

.brand-name {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--gold);
  letter-spacing: 2px;
  line-height: 1;
}

.brand-sub {
  font-size: 0.7rem;
  color: var(--neutral-400);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-top: 4px;
}

.sidebar-nav {
  flex: 1;
  overflow-y: auto;
  padding: var(--sp-md);
}

.nav-section-label {
  font-size: 0.65rem;
  color: var(--neutral-500);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  padding: var(--sp-md) var(--sp-sm) var(--sp-xs);
  font-weight: 600;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: var(--sp-sm);
  padding: var(--sp-sm) var(--sp-md);
  border-radius: var(--radius-sm);
  color: var(--neutral-400);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.2s var(--ease);
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  font-family: inherit;
}

.nav-item:hover {
  background: rgba(201, 148, 74, 0.08);
  color: var(--cream);
}

.nav-item.active {
  background: rgba(201, 148, 74, 0.15);
  color: var(--gold);
}

.nav-item .badge {
  margin-left: auto;
  background: var(--gold);
  color: var(--midnight);
  font-size: 0.65rem;
  font-weight: 700;
  padding: 1px 6px;
  border-radius: 10px;
  min-width: 18px;
  text-align: center;
}

.sidebar-footer {
  padding: var(--sp-md) var(--sp-lg);
  border-top: 1px solid rgba(201, 148, 74, 0.08);
  font-size: 0.7rem;
  color: var(--neutral-500);
}

.authority-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: rgba(201, 148, 74, 0.12);
  color: var(--gold);
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.65rem;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.theme-toggle {
  width: 28px;
  height: 28px;
  border-radius: 6px;
  border: 1px solid rgba(201, 148, 74, 0.2);
  background: transparent;
  cursor: pointer;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s var(--ease);
}

.theme-toggle:hover {
  border-color: var(--gold);
  background: rgba(201, 148, 74, 0.08);
}

/* â”€â”€â”€ Main Content â”€â”€â”€ */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.main-header {
  padding: var(--sp-md) var(--sp-xl);
  border-bottom: 1px solid rgba(201, 148, 74, 0.06);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--midnight);
}

.main-header h2 {
  font-size: 1.4rem;
}

.header-actions {
  display: flex;
  gap: var(--sp-sm);
}

.btn {
  padding: var(--sp-sm) var(--sp-md);
  border-radius: var(--radius-sm);
  border: 1px solid rgba(201, 148, 74, 0.2);
  background: transparent;
  color: var(--cream);
  font-family: inherit;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.2s var(--ease);
}

.btn:hover {
  border-color: var(--gold);
  color: var(--gold);
}

.btn-gold {
  background: var(--gold);
  color: var(--midnight);
  border-color: var(--gold);
  font-weight: 600;
}

.btn-gold:hover {
  background: var(--amber);
  border-color: var(--amber);
  color: var(--midnight);
}

/* â”€â”€â”€ Panels â”€â”€â”€ */
.panel {
  display: none;
  flex: 1;
  overflow-y: auto;
  padding: var(--sp-xl);
}

.panel.active { display: block; }

/* â”€â”€â”€ Command Panel (Chat) â”€â”€â”€ */
#panel-command {
  display: flex;
  flex-direction: column;
  padding: 0;
}

#panel-command.active { display: flex; }

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: var(--sp-xl);
}

.msg {
  margin-bottom: var(--sp-lg);
  max-width: 80%;
  animation: fadeUp 0.3s var(--ease);
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.msg.user {
  margin-left: auto;
}

.msg .bubble {
  padding: var(--sp-md) var(--sp-lg);
  border-radius: var(--radius-md);
  font-size: 0.9rem;
  line-height: 1.6;
}

.msg.assistant .bubble {
  background: var(--deep-navy);
  border: 1px solid rgba(201, 148, 74, 0.08);
}

.msg.user .bubble {
  background: rgba(201, 148, 74, 0.15);
  color: var(--warm-white);
}

.msg .meta {
  font-size: 0.7rem;
  color: var(--neutral-500);
  margin-top: 4px;
  padding: 0 4px;
}

.msg.user .meta { text-align: right; }

.chat-input-area {
  padding: var(--sp-md) var(--sp-xl) var(--sp-xl);
  border-top: 1px solid rgba(201, 148, 74, 0.06);
  background: var(--midnight);
}

.chat-input-wrapper {
  display: flex;
  gap: var(--sp-sm);
  align-items: center;
  background: var(--deep-navy);
  border: 1px solid rgba(201, 148, 74, 0.15);
  border-radius: var(--radius-md);
  padding: var(--sp-sm) var(--sp-md);
  transition: border-color 0.2s var(--ease);
}

.chat-input-wrapper:focus-within {
  border-color: var(--gold);
}

.chat-input {
  flex: 1;
  background: none;
  border: none;
  color: var(--cream);
  font-family: inherit;
  font-size: 0.9rem;
  outline: none;
  padding: var(--sp-sm);
}

.chat-input::placeholder { color: var(--neutral-500); }

.send-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--gold);
  border: none;
  color: var(--midnight);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s var(--ease);
  flex-shrink: 0;
}

.send-btn:hover { background: var(--amber); }

.mic-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: transparent;
  border: 1px solid rgba(201, 148, 74, 0.2);
  color: var(--neutral-400);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s var(--ease);
  flex-shrink: 0;
}

.mic-btn:hover {
  border-color: var(--gold);
  color: var(--gold);
}

.mic-btn.recording {
  background: var(--error);
  border-color: var(--error);
  color: white;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(199, 93, 93, 0.4); }
  50% { box-shadow: 0 0 0 8px rgba(199, 93, 93, 0); }
}

/* â”€â”€â”€ Dashboard Cards â”€â”€â”€ */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: var(--sp-lg);
  margin-bottom: var(--sp-xl);
}

.card {
  background: var(--deep-navy);
  border: 1px solid rgba(201, 148, 74, 0.06);
  border-radius: var(--radius-md);
  padding: var(--sp-lg);
  transition: all 0.2s var(--ease);
}

.card:hover {
  border-color: rgba(201, 148, 74, 0.15);
  transform: translateY(-1px);
}

.form-input {
  background: var(--navy);
  border: 1px solid rgba(201, 148, 74, 0.15);
  color: var(--cream);
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.85rem;
  width: 100%;
  transition: border-color 0.2s;
}
.form-input:focus {
  outline: none;
  border-color: var(--gold);
}
.form-input::placeholder { color: var(--neutral-500); }

.card-label {
  font-size: 0.7rem;
  color: var(--neutral-400);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: var(--sp-sm);
}

.card-value {
  font-family: 'Cormorant Garamond', serif;
  font-size: 2rem;
  font-weight: 700;
  color: var(--warm-white);
}

.card-value.gold { color: var(--gold); }
.card-value.success { color: var(--success); }
.card-value.info { color: var(--info); }

.card-detail {
  font-size: 0.75rem;
  color: var(--neutral-500);
  margin-top: var(--sp-xs);
}

/* â”€â”€â”€ Lists â”€â”€â”€ */
.list-item {
  display: flex;
  align-items: center;
  gap: var(--sp-md);
  padding: var(--sp-md);
  border-bottom: 1px solid rgba(201, 148, 74, 0.04);
  transition: background 0.15s var(--ease);
}

.list-item:hover {
  background: rgba(201, 148, 74, 0.04);
}

.list-item:last-child { border-bottom: none; }

.list-icon {
  width: 36px;
  height: 36px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  flex-shrink: 0;
}

.list-icon.rss { background: rgba(201, 148, 74, 0.12); }
.list-icon.reddit { background: rgba(199, 93, 93, 0.12); }
.list-icon.academic { background: rgba(90, 143, 201, 0.12); }
.list-icon.books { background: rgba(74, 155, 127, 0.12); }

.list-content { flex: 1; min-width: 0; }

.list-title {
  font-size: 0.85rem;
  color: var(--warm-white);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.list-meta {
  font-size: 0.7rem;
  color: var(--neutral-500);
}

.tag {
  display: inline-block;
  padding: 1px 6px;
  border-radius: 3px;
  font-size: 0.65rem;
  font-weight: 600;
}

.tag-gold { background: rgba(201, 148, 74, 0.15); color: var(--gold); }
.tag-info { background: rgba(90, 143, 201, 0.15); color: var(--info); }
.tag-success { background: rgba(74, 155, 127, 0.15); color: var(--success); }
.tag-warning { background: rgba(212, 160, 74, 0.15); color: var(--warning); }
.tag-error { background: rgba(199, 93, 93, 0.15); color: var(--error); }

/* â”€â”€â”€ Section Headers â”€â”€â”€ */
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--sp-md);
}

.section-title {
  font-size: 1.1rem;
  color: var(--warm-white);
}

/* â”€â”€â”€ Empty State â”€â”€â”€ */
.empty-state {
  text-align: center;
  padding: var(--sp-2xl);
  color: var(--neutral-500);
}

.empty-state .icon {
  font-size: 2.5rem;
  margin-bottom: var(--sp-md);
  opacity: 0.5;
}

/* â”€â”€â”€ Trend Bar â”€â”€â”€ */
.trend-bar {
  height: 4px;
  background: var(--navy);
  border-radius: 2px;
  margin-top: var(--sp-sm);
  overflow: hidden;
}

.trend-bar-fill {
  height: 100%;
  background: var(--gold);
  border-radius: 2px;
  transition: width 0.5s var(--ease);
}

/* â”€â”€â”€ Scrollbar â”€â”€â”€ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb {
  background: rgba(201, 148, 74, 0.15);
  border-radius: 3px;
}
::-webkit-scrollbar-thumb:hover {
  background: rgba(201, 148, 74, 0.3);
}

/* â”€â”€â”€ Responsive â”€â”€â”€ */
@media (max-width: 768px) {
  .sidebar { width: 60px; }
  .brand-name { font-size: 1rem; letter-spacing: 0; }
  .brand-sub, .nav-section-label { display: none; }
  .nav-item span { display: none; }
  .nav-item { justify-content: center; padding: var(--sp-sm); }
  .sidebar-footer { display: none; }
}
</style>
</head>
<body>
<div class="app">
  <!-- â”€â”€â”€ Sidebar â”€â”€â”€ -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-name">ELAINE</div>
      <div class="brand-sub">Chief of Staff Â· Almost Magic</div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section-label">Core</div>
      <button class="nav-item active" onclick="showPanel('command')">
        ğŸ’¬ <span>Command</span>
      </button>
      <button class="nav-item" onclick="showPanel('briefing')">
        â˜€ï¸ <span>Morning Briefing</span>
      </button>

      <div class="nav-section-label">Business Intelligence</div>
      <button class="nav-item" onclick="showPanel('clients')">
        ğŸ‘¥ <span>Clients</span>
      </button>
      <button class="nav-item" onclick="showPanel('pipeline')">
        ğŸ“Š <span>Pipeline</span>
      </button>
      <button class="nav-item" onclick="showPanel('projects')">
        ğŸ“ <span>Projects</span>
      </button>
      <button class="nav-item" onclick="showPanel('decisions')">
        âš–ï¸ <span>Decisions</span>
      </button>

      <div class="nav-section-label">The Current</div>
      <button class="nav-item" onclick="showPanel('discoveries')">
        ğŸ” <span>Discoveries</span>
        <span class="badge" id="badge-discoveries">0</span>
      </button>
      <button class="nav-item" onclick="showPanel('opportunities')">
        ğŸ’¡ <span>Content Ideas</span>
        <span class="badge" id="badge-opportunities">0</span>
      </button>
      <button class="nav-item" onclick="showPanel('trends')">
        ğŸ“ˆ <span>Trends</span>
      </button>
      <button class="nav-item" onclick="showPanel('competitors')">
        ğŸ¢ <span>Competitors</span>
      </button>

      <div class="nav-section-label">Chronicle</div>
      <button class="nav-item" onclick="showPanel('meetings')">
        ğŸ“… <span>Meetings</span>
      </button>
      <button class="nav-item" onclick="showPanel('actions')">
        âœ… <span>Action Items</span>
      </button>

      <div class="nav-section-label">People & Network</div>
      <button class="nav-item" onclick="showPanel('poi')">
        ğŸ‘ï¸ <span>People of Interest</span>
        <span class="badge" id="badge-poi">0</span>
      </button>

      <div class="nav-section-label">System</div>
      <button class="nav-item" onclick="showPanel('desktop')">
        ğŸ–¥ï¸ <span>Desktop Ops</span>
      </button>
      <button class="nav-item" onclick="showPanel('health')">
        ğŸ¥ <span>Health</span>
      </button>
      <button class="nav-item" onclick="showPanel('settings')">
        âš™ï¸ <span>Settings</span>
      </button>
    </nav>

    <div class="sidebar-footer">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
        <div class="authority-badge">â¬¡ Authority Level 2</div>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">ğŸŒ™</button>
      </div>
      <div>v3.4 Â· Phase 4</div>
    </div>
  </aside>

  <!-- â”€â”€â”€ Main Content â”€â”€â”€ -->
  <main class="main">
    <!-- Command Panel -->
    <div class="panel active" id="panel-command">
      <div class="main-header">
        <h2>Command</h2>
        <div class="header-actions">
          <button class="btn" onclick="clearChat()">Clear</button>
        </div>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="msg assistant">
          <div class="bubble">Good morning, Mani. ELAINE is operational â€” Phase 4 active.<br><br>
          Business Intelligence, The Current, and Chronicle are online. I'm monitoring your interest areas and ready to assist.<br><br>
          Try: <em>"Run a full scan"</em>, <em>"Show my pipeline"</em>, or <em>"Prepare for my next meeting"</em></div>
          <div class="meta">ELAINE Â· just now</div>
        </div>
      </div>
      <div class="chat-input-area">
        <div class="chat-input-wrapper">
          <button class="mic-btn" id="micBtn" onclick="toggleMic()">ğŸ¤</button>
          <input type="text" class="chat-input" id="chatInput"
                 placeholder="Ask Elaine anything..."
                 onkeypress="if(event.key==='Enter')sendMessage()">
          <button class="send-btn" onclick="sendMessage()">â†’</button>
        </div>
      </div>
    </div>

    <!-- Morning Briefing Panel -->
    <div class="panel" id="panel-briefing">
      <div class="main-header">
        <h2>Morning Briefing</h2>
        <div class="header-actions">
          <button class="btn-gold btn" onclick="refreshBriefing()">Refresh</button>
        </div>
      </div>
      <div id="briefingContent" style="padding:var(--sp-lg);">
        <div class="empty-state">
          <div class="icon">â˜€ï¸</div>
          <p>Loading your morning briefing...</p>
        </div>
      </div>
    </div>

    <!-- Clients Panel -->
    <div class="panel" id="panel-clients">
      <div class="main-header">
        <h2>Client Intelligence</h2>
        <div class="header-actions">
          <button class="btn-gold btn" onclick="showAddClient()">+ Add Client</button>
        </div>
      </div>
      <div id="clientsContent" style="padding:var(--sp-lg);">
        <div class="dashboard-grid" id="clientStats"></div>
        <div id="clientList"></div>
      </div>
    </div>

    <!-- Pipeline Panel -->
    <div class="panel" id="panel-pipeline">
      <div class="main-header">
        <h2>Pipeline</h2>
        <div class="header-actions">
          <button class="btn-gold btn" onclick="showAddOpportunity()">+ Opportunity</button>
        </div>
      </div>
      <div id="pipelineContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Projects Panel -->
    <div class="panel" id="panel-projects">
      <div class="main-header"><h2>Active Projects</h2></div>
      <div id="projectsContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Decisions Panel -->
    <div class="panel" id="panel-decisions">
      <div class="main-header"><h2>Decision Log</h2></div>
      <div id="decisionsContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Discoveries Panel -->
    <div class="panel" id="panel-discoveries">
      <div class="main-header">
        <h2>Discoveries</h2>
        <div class="header-actions">
          <button class="btn" onclick="runScan()">ğŸ”„ Scan Now</button>
          <button class="btn" onclick="toggleAutoScan()">â° Auto-Scan</button>
        </div>
      </div>
      <div id="discoveriesContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Content Opportunities Panel -->
    <div class="panel" id="panel-opportunities">
      <div class="main-header"><h2>Content Opportunities</h2></div>
      <div id="opportunitiesContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Trends Panel -->
    <div class="panel" id="panel-trends">
      <div class="main-header"><h2>Trend Radar</h2></div>
      <div id="trendsContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Competitors Panel -->
    <div class="panel" id="panel-competitors">
      <div class="main-header">
        <h2>Competitor Watch</h2>
        <div class="header-actions">
          <button class="btn-gold btn" onclick="showAddCompetitor()">+ Add</button>
        </div>
      </div>
      <div id="competitorsContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Meetings Panel -->
    <div class="panel" id="panel-meetings">
      <div class="main-header">
        <h2>Chronicle â€” Meetings</h2>
        <div class="header-actions">
          <button class="btn-gold btn" onclick="showCreateMeeting()">+ Meeting</button>
        </div>
      </div>
      <div id="meetingsContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Action Items Panel -->
    <div class="panel" id="panel-actions">
      <div class="main-header"><h2>Action Items</h2></div>
      <div id="actionsContent" style="padding:var(--sp-lg);"></div>
    </div>

    <!-- Desktop Ops Panel -->
    <div class="panel" id="panel-desktop">
      <div class="main-header"><h2>Desktop Operations</h2></div>
      <div style="padding:var(--sp-lg);">
        <div class="dashboard-grid">
          <div class="card" onclick="sendCmd('open chrome')">
            <div class="card-label">Launch</div>
            <div style="font-size:1.5rem;">ğŸŒ</div>
            <div class="card-detail">Open Chrome</div>
          </div>
          <div class="card" onclick="sendCmd('open outlook')">
            <div class="card-label">Launch</div>
            <div style="font-size:1.5rem;">ğŸ“§</div>
            <div class="card-detail">Open Outlook</div>
          </div>
          <div class="card" onclick="sendCmd('open claude desktop')">
            <div class="card-label">Launch</div>
            <div style="font-size:1.5rem;">ğŸ¤–</div>
            <div class="card-detail">Claude Desktop</div>
          </div>
          <div class="card" onclick="sendCmd('search my files for')">
            <div class="card-label">Search</div>
            <div style="font-size:1.5rem;">ğŸ”</div>
            <div class="card-detail">File Search</div>
          </div>
          <div class="card" onclick="sendCmd('system status')">
            <div class="card-label">System</div>
            <div style="font-size:1.5rem;">ğŸ“Š</div>
            <div class="card-detail">System Status</div>
          </div>
          <div class="card" onclick="sendCmd('what time is it')">
            <div class="card-label">Utility</div>
            <div style="font-size:1.5rem;">ğŸ•</div>
            <div class="card-detail">Current Time</div>
          </div>
        </div>
      </div>
    </div>

    <!-- People of Interest Panel -->
    <div class="panel" id="panel-poi">
      <div class="main-header">
        <h2>People of Interest</h2>
        <div class="header-actions">
          <button class="btn" onclick="runPoiDiscover()">ğŸ¤– Auto-Discover</button>
          <button class="btn" onclick="runPoiScan()">ğŸ” Scan Activity</button>
          <button class="btn-gold btn" onclick="showAddPoi()">+ Add Person</button>
        </div>
      </div>
      <div style="padding:var(--sp-lg);">
        <div class="dashboard-grid" id="poiStats"></div>
        <div id="poiList"></div>
        <div id="poiAddForm" style="display:none;" class="card" data-form="poi">
          <h3 style="margin-bottom:var(--sp-md);">Add Person of Interest</h3>
          <div style="display:flex;flex-direction:column;gap:var(--sp-sm);">
            <input type="text" id="poiName" placeholder="Full name" class="form-input">
            <input type="text" id="poiCompany" placeholder="Company (optional)" class="form-input">
            <input type="text" id="poiRole" placeholder="Role (optional)" class="form-input">
            <input type="text" id="poiLinkedin" placeholder="LinkedIn URL (optional)" class="form-input">
            <input type="text" id="poiEmail" placeholder="Email (optional)" class="form-input">
            <input type="text" id="poiWhy" placeholder="Why are they important? (optional)" class="form-input">
            <select id="poiCategory" class="form-input">
              <option value="general">General</option>
              <option value="client">Client</option>
              <option value="competitor">Competitor</option>
              <option value="influencer">Influencer</option>
              <option value="partner">Potential Partner</option>
              <option value="thought_leader">Thought Leader</option>
              <option value="journalist">Journalist/Media</option>
            </select>
            <label style="font-size:0.85rem;color:var(--neutral-400);">
              Interest Level (1-10):
              <input type="range" id="poiLevel" min="1" max="10" value="6"
                     style="margin-left:8px;vertical-align:middle;">
              <span id="poiLevelDisplay">6</span>
            </label>
            <button class="btn-gold btn" onclick="addPoi()">Track This Person</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Health Panel -->
    <div class="panel" id="panel-health">
      <div class="main-header">
        <h2>System Health</h2>
        <div class="header-actions">
          <button class="btn-gold btn" onclick="runHealthCheck()">Run Health Check</button>
        </div>
      </div>
      <div style="padding:var(--sp-lg);">
        <div id="healthContent">
          <div class="empty-state">
            <div class="icon">ğŸ¥</div>
            <p>Click "Run Health Check" to diagnose all modules.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Panel -->
    <div class="panel" id="panel-settings">
      <div class="main-header"><h2>Settings</h2></div>
      <div style="padding:var(--sp-lg);">
        <div class="card" style="max-width:500px;">
          <h3 style="margin-bottom:var(--sp-md);">The Current â€” Scan Schedule</h3>
          <div style="display:flex;flex-direction:column;gap:var(--sp-sm);">
            <label style="font-size:0.85rem;color:var(--neutral-400);">
              Auto-scan interval (hours):
              <input type="number" value="6" min="1" max="24" id="scanInterval"
                     style="background:var(--navy);border:1px solid rgba(201,148,74,0.15);
                     color:var(--cream);padding:6px 10px;border-radius:var(--radius-sm);
                     width:60px;margin-left:8px;">
            </label>
            <label style="font-size:0.85rem;color:var(--neutral-400);">
              <input type="checkbox" id="autoScanEnabled"> Enable background scanning
            </label>
          </div>
        </div>
        <div class="card" style="max-width:500px;margin-top:var(--sp-md);">
          <h3 style="margin-bottom:var(--sp-md);">Interest Areas</h3>
          <div id="interestAreasConfig"></div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ELAINE Phase 4 â€” Frontend Logic
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const API = '';  // Same-origin

// â”€â”€â”€ Theme Toggle â”€â”€â”€
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const btn = document.querySelector('.theme-toggle');
  if (current === 'light') {
    html.removeAttribute('data-theme');
    btn.textContent = 'ğŸŒ™';
    localStorage.setItem('elaine-theme', 'dark');
    document.querySelector('meta[name="theme-color"]').content = '#0A0E14';
  } else {
    html.setAttribute('data-theme', 'light');
    btn.textContent = 'â˜€ï¸';
    localStorage.setItem('elaine-theme', 'light');
    document.querySelector('meta[name="theme-color"]').content = '#F8F7F5';
  }
}

// Apply saved theme on load
(function() {
  const saved = localStorage.getItem('elaine-theme');
  if (saved === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.querySelector('.theme-toggle');
      if (btn) btn.textContent = 'â˜€ï¸';
    });
  }
})();

// â”€â”€â”€ Panel Navigation â”€â”€â”€
function showPanel(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const panel = document.getElementById('panel-' + id);
  if (panel) panel.classList.add('active');
  event.currentTarget.classList.add('active');
  // Load data for panel
  loadPanelData(id);
}

function loadPanelData(id) {
  switch(id) {
    case 'briefing': loadBriefing(); break;
    case 'clients': loadClients(); break;
    case 'pipeline': loadPipeline(); break;
    case 'projects': loadProjects(); break;
    case 'decisions': loadDecisions(); break;
    case 'discoveries': loadDiscoveries(); break;
    case 'opportunities': loadOpportunities(); break;
    case 'trends': loadTrends(); break;
    case 'competitors': loadCompetitors(); break;
    case 'meetings': loadMeetings(); break;
    case 'actions': loadActions(); break;
  }
}

// â”€â”€â”€ Chat â”€â”€â”€
function sendMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  addMsg('user', text);
  input.value = '';

  fetch(API + '/command', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({command: text})
  })
  .then(r => r.json())
  .then(data => addMsg('assistant', data.response || data.result || JSON.stringify(data)))
  .catch(e => addMsg('assistant', 'Connection error. Is the server running?'));
}

function sendCmd(cmd) {
  document.getElementById('chatInput').value = cmd;
  // Switch to command panel
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-command').classList.add('active');
  if (cmd.endsWith(' for') || cmd.endsWith(' for ')) {
    document.getElementById('chatInput').focus();
  } else {
    sendMessage();
  }
}

function addMsg(role, text) {
  const div = document.createElement('div');
  div.className = 'msg ' + role;
  const time = new Date().toLocaleTimeString('en-AU', {hour:'2-digit', minute:'2-digit'});
  div.innerHTML = `<div class="bubble">${text}</div>
    <div class="meta">${role === 'user' ? 'You' : 'ELAINE'} Â· ${time}</div>`;
  document.getElementById('chatMessages').appendChild(div);
  div.scrollIntoView({behavior: 'smooth'});
}

function clearChat() {
  const msgs = document.getElementById('chatMessages');
  msgs.innerHTML = '';
  addMsg('assistant', 'Chat cleared. How can I help?');
}

// â”€â”€â”€ Mic â”€â”€â”€
let mediaRecorder = null;
function toggleMic() {
  const btn = document.getElementById('micBtn');
  if (btn.classList.contains('recording')) {
    btn.classList.remove('recording');
    if (mediaRecorder) mediaRecorder.stop();
  } else {
    btn.classList.add('recording');
    navigator.mediaDevices.getUserMedia({audio: true}).then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      const chunks = [];
      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = () => {
        stream.getTracks().forEach(t => t.stop());
        const blob = new Blob(chunks, {type:'audio/webm'});
        const fd = new FormData();
        fd.append('audio', blob, 'voice.webm');
        fetch(API + '/voice', {method:'POST', body:fd})
          .then(r => r.json())
          .then(d => {
            if (d.text) {
              document.getElementById('chatInput').value = d.text;
              sendMessage();
            }
          }).catch(()=>{});
      };
      mediaRecorder.start();
      setTimeout(() => { if (btn.classList.contains('recording')) toggleMic(); }, 10000);
    }).catch(()=> btn.classList.remove('recording'));
  }
}

// â”€â”€â”€ API Helpers â”€â”€â”€
async function apiFetch(url) {
  try {
    const r = await fetch(API + url);
    return await r.json();
  } catch(e) { return null; }
}

async function apiPost(url, data) {
  try {
    const r = await fetch(API + url, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(data)
    });
    return await r.json();
  } catch(e) { return null; }
}

// â”€â”€â”€ Load Functions â”€â”€â”€
async function loadBriefing() {
  const data = await apiFetch('/api/current/briefing');
  const el = document.getElementById('briefingContent');
  if (!data) { el.innerHTML = '<div class="empty-state"><div class="icon">â˜€ï¸</div><p>Run your first scan to generate a briefing.</p><button class="btn-gold btn" onclick="runScan()">ğŸ”„ Run First Scan</button></div>'; return; }

  el.innerHTML = `
    <h3 style="color:var(--gold);margin-bottom:var(--sp-lg);">${data.date || 'Today\'s Briefing'}</h3>
    <div class="dashboard-grid">
      <div class="card"><div class="card-label">New Discoveries</div><div class="card-value gold">${data.total_new || 0}</div></div>
      <div class="card"><div class="card-label">Hot Trends</div><div class="card-value info">${(data.hot_trends||[]).length}</div></div>
      <div class="card"><div class="card-label">Urgent Content Ideas</div><div class="card-value">${(data.urgent_content||[]).length}</div></div>
    </div>
    ${(data.top_discoveries||[]).length ? '<div class="section-header"><h3 class="section-title">Top Discoveries</h3></div>' + (data.top_discoveries||[]).slice(0,5).map(d => `
      <div class="list-item">
        <div class="list-icon ${d.source}">${sourceIcon(d.source)}</div>
        <div class="list-content">
          <div class="list-title">${d.title||''}</div>
          <div class="list-meta">${d.interest_area||''} Â· ${d.source||''}</div>
        </div>
        <span class="tag tag-gold">${(d.relevance_score * 100).toFixed(0)}%</span>
      </div>`).join('') : ''}
  `;
}

async function loadClients() {
  const clients = await apiFetch('/api/business/clients');
  const el = document.getElementById('clientList');
  if (!clients || !clients.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘¥</div><p>No clients yet. Add your first client to get started.</p></div>';
    return;
  }
  el.innerHTML = clients.map(c => `
    <div class="list-item">
      <div class="list-icon" style="background:rgba(201,148,74,0.12);color:var(--gold);">${(c.name||'?')[0]}</div>
      <div class="list-content">
        <div class="list-title">${c.name}${c.company ? ' Â· ' + c.company : ''}</div>
        <div class="list-meta">${c.industry||''} Â· ${c.region||'AU'} Â· Last contact: ${c.last_contact ? new Date(c.last_contact).toLocaleDateString() : 'Never'}</div>
      </div>
      <span class="tag tag-${statusColor(c.status)}">${c.status||'prospect'}</span>
    </div>`).join('');
}

async function loadPipeline() {
  const [pipeline, value] = await Promise.all([
    apiFetch('/api/business/pipeline'),
    apiFetch('/api/business/pipeline/value')
  ]);
  const el = document.getElementById('pipelineContent');
  el.innerHTML = `
    <div class="dashboard-grid">
      <div class="card"><div class="card-label">Weighted Pipeline</div><div class="card-value gold">$${((value?.weighted_value||0)/1000).toFixed(0)}k</div></div>
      <div class="card"><div class="card-label">Total Pipeline</div><div class="card-value">$${((value?.total_value||0)/1000).toFixed(0)}k</div></div>
      <div class="card"><div class="card-label">Opportunities</div><div class="card-value info">${value?.count||0}</div></div>
    </div>
    ${(pipeline||[]).map(p => `
      <div class="list-item">
        <div class="list-content">
          <div class="list-title">${p.opportunity}</div>
          <div class="list-meta">${p.client_name||''} Â· ${p.service_type||''} Â· Close: ${p.expected_close||'TBD'}</div>
        </div>
        <span style="color:var(--gold);font-weight:600;">$${(p.estimated_value||0).toLocaleString()}</span>
        <span class="tag tag-gold">${(p.probability*100).toFixed(0)}%</span>
      </div>`).join('') || '<div class="empty-state"><div class="icon">ğŸ“Š</div><p>No opportunities yet.</p></div>'}`;
}

async function loadProjects() {
  const projects = await apiFetch('/api/business/projects');
  const el = document.getElementById('projectsContent');
  if (!projects || !projects.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“</div><p>No active projects.</p></div>';
    return;
  }
  el.innerHTML = projects.map(p => `
    <div class="list-item">
      <div class="list-content">
        <div class="list-title">${p.name}</div>
        <div class="list-meta">${p.client_name||''} Â· ${p.service_type||''} Â· ${p.status||'planning'}</div>
      </div>
      <span class="tag tag-${p.status==='active'?'success':'info'}">${p.status}</span>
    </div>`).join('');
}

async function loadDecisions() {
  const decisions = await apiFetch('/api/business/decisions/review');
  const el = document.getElementById('decisionsContent');
  if (!decisions || !decisions.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">âš–ï¸</div><p>No decisions pending review.</p></div>';
    return;
  }
  el.innerHTML = decisions.map(d => `
    <div class="list-item">
      <div class="list-content">
        <div class="list-title">${d.title}</div>
        <div class="list-meta">${d.category||''} Â· Impact: ${d.impact} Â· Review: ${d.review_date||''}</div>
      </div>
      <span class="tag tag-${d.impact==='high'?'error':d.impact==='medium'?'warning':'info'}">${d.impact}</span>
    </div>`).join('');
}

async function loadDiscoveries() {
  const discoveries = await apiFetch('/api/current/discoveries?limit=50');
  const el = document.getElementById('discoveriesContent');
  if (!discoveries || !discoveries.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ”</div><p>No discoveries yet. Run your first scan!</p><button class="btn-gold btn" onclick="runScan()">ğŸ”„ Scan Now</button></div>';
    return;
  }
  el.innerHTML = discoveries.map(d => `
    <div class="list-item">
      <div class="list-icon ${d.source}">${sourceIcon(d.source)}</div>
      <div class="list-content">
        <div class="list-title">${d.title||''}</div>
        <div class="list-meta">${d.interest_area||''} Â· ${d.source||''} Â· ${d.author||''}</div>
      </div>
      ${d.source_url ? `<a href="${d.source_url}" target="_blank" style="color:var(--gold);text-decoration:none;font-size:0.75rem;">Open â†—</a>` : ''}
    </div>`).join('');
}

async function loadOpportunities() {
  const ops = await apiFetch('/api/current/opportunities');
  const el = document.getElementById('opportunitiesContent');
  if (!ops || !ops.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ’¡</div><p>Run a scan to generate content opportunities.</p></div>';
    return;
  }
  el.innerHTML = ops.map(o => `
    <div class="list-item">
      <div class="list-content">
        <div class="list-title">${o.title||''}</div>
        <div class="list-meta">${o.hook||''}</div>
      </div>
      <span class="tag tag-gold">${formatLabel(o.format)}</span>
      ${o.urgency==='time_sensitive' ? '<span class="tag tag-error">urgent</span>' : ''}
    </div>`).join('');
}

async function loadTrends() {
  const trends = await apiFetch('/api/current/trends');
  const el = document.getElementById('trendsContent');
  if (!trends || !trends.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“ˆ</div><p>No trends detected yet. Trends emerge after multiple scans.</p></div>';
    return;
  }
  const maxVel = Math.max(...trends.map(t => t.velocity || 0), 1);
  el.innerHTML = trends.map(t => `
    <div class="card" style="margin-bottom:var(--sp-md);">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-weight:600;color:var(--warm-white);">${t.topic}</div>
          <div style="font-size:0.75rem;color:var(--neutral-400);">${t.interest_area} Â· ${t.mention_count} mentions</div>
        </div>
        <span class="tag tag-${t.status==='accelerating'?'error':t.status==='emerging'?'gold':'info'}">${t.status}</span>
      </div>
      <div class="trend-bar"><div class="trend-bar-fill" style="width:${(t.velocity/maxVel)*100}%"></div></div>
    </div>`).join('');
}

async function loadCompetitors() {
  const comps = await apiFetch('/api/current/competitors');
  const el = document.getElementById('competitorsContent');
  if (!comps || !comps.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ¢</div><p>No competitors tracked yet.</p></div>';
    return;
  }
  el.innerHTML = comps.map(c => `
    <div class="list-item">
      <div class="list-icon" style="background:rgba(199,93,93,0.12);">ğŸ¢</div>
      <div class="list-content">
        <div class="list-title">${c.name}</div>
        <div class="list-meta">${c.region||'AU'}${c.website ? ' Â· '+c.website : ''}</div>
      </div>
    </div>`).join('');
}

async function loadMeetings() {
  const meetings = await apiFetch('/api/chronicle/meetings?days=14');
  const el = document.getElementById('meetingsContent');
  if (!meetings || !meetings.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“…</div><p>No upcoming meetings.</p></div>';
    return;
  }
  el.innerHTML = meetings.map(m => `
    <div class="list-item">
      <div class="list-icon" style="background:rgba(90,143,201,0.12);">ğŸ“…</div>
      <div class="list-content">
        <div class="list-title">${m.title}</div>
        <div class="list-meta">${m.meeting_type||''} Â· ${m.scheduled_at ? new Date(m.scheduled_at).toLocaleString() : 'TBD'} Â· ${m.duration_minutes||60}min</div>
      </div>
      <button class="btn" onclick="prepMeeting(${m.id})">Prep</button>
    </div>`).join('');
}

async function loadActions() {
  const actions = await apiFetch('/api/chronicle/actions');
  const el = document.getElementById('actionsContent');
  if (!actions || !actions.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">âœ…</div><p>No pending action items.</p></div>';
    return;
  }
  el.innerHTML = actions.map(a => `
    <div class="list-item">
      <div class="list-content">
        <div class="list-title">${typeof a.action === 'string' ? a.action : JSON.stringify(a.action)}</div>
        <div class="list-meta">From: ${a.meeting_title} Â· Follow-up: ${a.follow_up_date||'TBD'}</div>
      </div>
    </div>`).join('');
}

// â”€â”€â”€ Actions â”€â”€â”€
async function runScan() {
  addMsg('assistant', 'ğŸ”„ Running full scan across all interest areas... This may take a moment.');
  const result = await apiPost('/api/current/scan', {});
  if (result) {
    addMsg('assistant', `âœ… Scan complete! Found ${result.total_new || 0} new items.`);
    loadBadges();
  } else {
    addMsg('assistant', 'âš ï¸ Scan encountered an error. Check that dependencies are installed.');
  }
}

async function toggleAutoScan() {
  const interval = parseInt(document.getElementById('scanInterval')?.value || 6);
  const result = await apiPost('/api/current/scan/start', {interval_hours: interval});
  if (result) addMsg('assistant', `â° Auto-scan ${result.status}. Interval: ${interval}h`);
}

function refreshBriefing() { loadBriefing(); }

async function prepMeeting(id) {
  const prep = await apiFetch(`/api/chronicle/meetings/${id}/prep`);
  if (prep) {
    let msg = `ğŸ“‹ **Meeting Prep: ${prep.meeting?.title||''}**\n\n`;
    if (prep.agenda?.length) msg += `Agenda: ${prep.agenda.join(', ')}\n`;
    if (prep.objectives?.length) msg += `Objectives: ${prep.objectives.join(', ')}\n`;
    if (prep.client_context) msg += `Client: ${prep.client_context.name} (${prep.client_context.status})\n`;
    addMsg('assistant', msg.replace(/\n/g, '<br>'));
  }
}

// â”€â”€â”€ Placeholder modals â”€â”€â”€
function showAddClient() { addMsg('assistant', 'To add a client, tell me: "Add client [Name] at [Company] in [Industry]"'); showPanel('command'); }
function showAddOpportunity() { addMsg('assistant', 'To add an opportunity, tell me: "New opportunity [Description] for [Client] worth $[Value]"'); showPanel('command'); }
function showAddCompetitor() { addMsg('assistant', 'To track a competitor, tell me: "Track competitor [Name] at [website]"'); showPanel('command'); }
function showCreateMeeting() { addMsg('assistant', 'To create a meeting, tell me: "Schedule meeting [Title] with [Attendees] on [Date]"'); showPanel('command'); }

// â”€â”€â”€ Helpers â”€â”€â”€
function sourceIcon(s) {
  return {rss:'ğŸ“°', reddit:'ğŸ”´', academic:'ğŸ“„', books:'ğŸ“š'}[s] || 'ğŸ“Œ';
}

function statusColor(s) {
  return {active:'success', prospect:'gold', lead:'info', lost:'error', won:'success'}[s] || 'gold';
}

function formatLabel(f) {
  return (f||'').replace(/_/g,' ').replace(/\b\w/g, c => c.toUpperCase());
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PEOPLE OF INTEREST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showAddPoi() {
  const form = document.getElementById('poiAddForm');
  form.style.display = form.style.display === 'none' ? 'block' : 'none';
}

document.getElementById('poiLevel')?.addEventListener('input', function() {
  document.getElementById('poiLevelDisplay').textContent = this.value;
});

async function addPoi() {
  const data = {
    name: document.getElementById('poiName').value,
    company: document.getElementById('poiCompany').value || null,
    role: document.getElementById('poiRole').value || null,
    linkedin_url: document.getElementById('poiLinkedin').value || null,
    email: document.getElementById('poiEmail').value || null,
    why_important: document.getElementById('poiWhy').value || null,
    category: document.getElementById('poiCategory').value,
    interest_level: parseInt(document.getElementById('poiLevel').value)
  };
  if (!data.name) return;
  const result = await apiPost('/api/poi', data);
  if (result) {
    document.getElementById('poiAddForm').style.display = 'none';
    ['poiName','poiCompany','poiRole','poiLinkedin','poiEmail','poiWhy'].forEach(id => {
      document.getElementById(id).value = '';
    });
    loadPoi();
  }
}

async function loadPoi() {
  const people = await apiFetch('/api/poi');
  const stats = await apiFetch('/api/poi/stats');
  const el = document.getElementById('poiList');
  const statsEl = document.getElementById('poiStats');

  if (stats) {
    statsEl.innerHTML = `
      <div class="stat-card"><div class="stat-value">${stats.total||0}</div><div class="stat-label">Total Tracked</div></div>
      <div class="stat-card"><div class="stat-value">${stats.manual||0}</div><div class="stat-label">Manual</div></div>
      <div class="stat-card"><div class="stat-value">${stats.auto_discovered||0}</div><div class="stat-label">Auto-Discovered</div></div>
      <div class="stat-card"><div class="stat-value">${stats.recent_activity_24h||0}</div><div class="stat-label">Activity (24h)</div></div>`;
  }

  if (!people || !people.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘ï¸</div><p>No people tracked yet. Click "+ Add Person" or run Auto-Discover.</p></div>';
    return;
  }
  el.innerHTML = people.map(p => {
    const stars = 'â­'.repeat(Math.min(p.interest_level || 0, 5));
    const auto = p.auto_discovered ? ' <span style="color:var(--info);font-size:0.7rem;">ğŸ¤– auto</span>' : '';
    const company = p.company ? ` â€” ${p.company}` : '';
    const cat = p.category ? `<span style="color:var(--neutral-400);font-size:0.75rem;">${formatLabel(p.category)}</span>` : '';
    return `<div class="list-item">
      <div class="list-content">
        <div class="list-title">${stars} ${p.name}${company}${auto}</div>
        <div class="list-meta">${cat} ${p.why_important||''}</div>
        ${p.role ? `<div class="list-meta">${p.role}</div>` : ''}
      </div>
      <button class="btn" onclick="removePoi(${p.id})" style="font-size:0.75rem;">âœ•</button>
    </div>`;
  }).join('');
}

async function removePoi(id) {
  await fetch(`/api/poi/${id}`, {method:'DELETE'});
  loadPoi();
}

async function runPoiScan() {
  const el = document.getElementById('poiList');
  el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ”</div><p>Scanning for activity...</p></div>';
  const result = await apiPost('/api/poi/scan', {max_people: 10});
  if (result && result.results) {
    let html = `<div class="card" style="margin-bottom:var(--sp-md);"><strong>Scanned ${result.scanned} people Â· ${result.with_activity} with new activity</strong></div>`;
    if (result.results.length) {
      html += result.results.map(r => `<div class="list-item"><div class="list-content">
        <div class="list-title">ğŸ‘¤ ${r.person} ${r.company ? '('+r.company+')' : ''}</div>
        ${r.new_activity.map(a => `<div class="list-meta">â†’ ${a.title.substring(0,80)}</div>`).join('')}
      </div></div>`).join('');
    } else {
      html += '<div class="list-meta" style="padding:var(--sp-md);">No new activity found. Elaine keeps checking.</div>';
    }
    el.innerHTML = html;
  }
  setTimeout(loadPoi, 3000);
}

async function runPoiDiscover() {
  const result = await apiPost('/api/poi/discover', {});
  if (result) {
    const clients = (result.from_clients||[]).length;
    const meetings = (result.from_meetings||[]).length;
    addMsg('assistant', `ğŸ¤– Auto-discovery complete!\n\nFrom clients: ${clients} new people\nFrom meetings: ${meetings} new people`);
    loadPoi();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HEALTH CHECK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function runHealthCheck() {
  const el = document.getElementById('healthContent');
  el.innerHTML = '<div class="empty-state"><div class="icon">â³</div><p>Running health checks...</p></div>';

  const checks = await apiPost('/api/health/check', {});
  const report = await apiFetch('/api/health/detailed');

  if (!checks && !report) {
    el.innerHTML = '<div class="empty-state"><div class="icon">âŒ</div><p>Health check failed.</p></div>';
    return;
  }

  let html = '';
  if (report) {
    const overall = report.overall || 'unknown';
    const icon = overall === 'healthy' ? 'ğŸŸ¢' : overall === 'degraded' ? 'ğŸŸ¡' : 'ğŸ”´';
    html += `<div class="card" style="margin-bottom:var(--sp-md);">
      <h3>${icon} Overall: ${overall.toUpperCase()}</h3>
      <div class="list-meta">Healthy: ${report.summary?.healthy||0} Â· Degraded: ${report.summary?.degraded||0} Â· Unhealthy: ${report.summary?.unhealthy||0}</div>
    </div>`;
  }

  if (checks) {
    html += '<div class="card"><h3 style="margin-bottom:var(--sp-sm);">Module Checks</h3>';
    for (const [name, check] of Object.entries(checks)) {
      const icon = check.status === 'healthy' ? 'âœ…' : check.status === 'degraded' ? 'âš ï¸' : 'âŒ';
      const ms = check.response_ms ? ` (${check.response_ms}ms)` : '';
      html += `<div class="list-item"><div class="list-content">
        <div class="list-title">${icon} ${formatLabel(name)}${ms}</div>
        ${check.error ? `<div class="list-meta" style="color:var(--error);">${check.error}</div>` : ''}
      </div></div>`;
    }
    html += '</div>';
  }

  if (report && report.recent_errors && report.recent_errors.length) {
    html += '<div class="card" style="margin-top:var(--sp-md);"><h3 style="margin-bottom:var(--sp-sm);">Recent Errors</h3>';
    for (const err of report.recent_errors.slice(0, 10)) {
      html += `<div class="list-item"><div class="list-content">
        <div class="list-title">${err.module}: ${err.error_type}</div>
        <div class="list-meta">${err.error_message?.substring(0,80)} Â· ${err.created_at}</div>
      </div></div>`;
    }
    html += '</div>';
  }

  el.innerHTML = html;
}

// â”€â”€â”€ Badge Updates â”€â”€â”€
async function loadBadges() {
  const data = await apiFetch('/api/current/dashboard');
  if (data) {
    document.getElementById('badge-discoveries').textContent = data.unread_discoveries || 0;
    document.getElementById('badge-opportunities').textContent = data.content_opportunities || 0;
  }
  // POI badge
  const poi = await apiFetch('/api/poi/stats');
  if (poi) {
    document.getElementById('badge-poi').textContent = poi.recent_activity_24h || 0;
  }
}

// â”€â”€â”€ Init â”€â”€â”€
loadBadges();
</script>
</body>
</html>
